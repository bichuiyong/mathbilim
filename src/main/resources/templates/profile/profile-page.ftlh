<#import "../layout.ftlh" as main>
<#import "/spring.ftl" as spring>
<@main.layout title="–ü—Ä–æ—Ñ–∏–ª—å">

    <#assign known = SPRING_SECURITY_CONTEXT?? >
    <#if known>
        <#assign
        authorities = SPRING_SECURITY_CONTEXT.authentication.authorities?map(auth -> auth.authority)
        isAdmin = authorities?seq_contains("ROLE_ADMIN")
        isModer = authorities?seq_contains("ROLE_MODER") || isAdmin
        >
    </#if>

    <div class="container mt-4" data-user-id="${user.id!}">
        <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="row">
            <div class="col-lg-4 mb-4">
                <div class="card profile-card">
                    <div class="card-body text-center">
                        <div class="profile-avatar-container mb-3">
                            <#if user.avatar??>
                                <img src="/api/files/${user.avatar.id}/download" alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar">
                            <#else>
                                <div class="profile-avatar-placeholder">
                                    <i class="fas fa-user"></i>
                                </div>
                            </#if>
                            <button class="btn btn-sm btn-primary profile-avatar-edit" data-bs-toggle="modal"
                                    data-bs-target="#avatarModal">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>

                        <h4 class="mb-1">${user.name!} ${user.surname!}</h4>
                        <p class="text-muted mb-2">${user.email}</p>

                        <#if user.type??>
                            <span class="badge bg-light-blue text-primary mb-3">
                            ${user.type.userTypeTranslations[0].translation}
                        </span>
                        </#if>


                        <div class="d-flex justify-content-center gap-2 mb-3">
                            <#if isAdmin>
                                <span class="badge bg-danger">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                            <#elseif isModer>
                                <span class="badge bg-warning">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</span>
                            <#else>
                                <span class="badge bg-info">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                            </#if>
                        </div>

                        <div class="profile-stats">
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="stat-value" id="totalContent">0</div>
                                    <div class="stat-label">–ö–æ–Ω—Ç–µ–Ω—Ç–∞</div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-value" id="approvedContent">0</div>
                                    <div class="stat-label">–û–¥–æ–±—Ä–µ–Ω–æ</div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-value" id="pendingContent">0</div>
                                    <div class="stat-label">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <a href="/profile/edit" class="btn btn-outline-primary btn-sm w-100">
                            <i class="fas fa-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                        </a>

                        <a href="https://t.me/Math_Bilim_bot?start=${user.id}"
                           target="_blank" class="btn btn-outline-primary btn-sm w-100">
                            üì≤ –ü–æ–¥–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
                        </a>
                    </div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h6 class="card-title mb-3">–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</h6>
                        <div class="d-grid gap-2">
                            <a href="/posts/create" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-newspaper me-2"></i>–ü—É–±–ª–∏–∫–∞—Ü–∏—è
                            </a>
                            <a href="/blog/create" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-blog me-2"></i>–ë–ª–æ–≥
                            </a>
                            <a href="/events/create" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-calendar-alt me-2"></i>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                            </a>
                            <a href="/books/create" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-book me-2"></i>–ö–Ω–∏–≥–∞
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <!-- –¢–∞–±—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ -->
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="profileTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="content-tab" data-bs-toggle="tab"
                                        data-bs-target="#content" type="button" role="tab">
                                    <i class="fas fa-file-alt me-2"></i>–ú–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
                                </button>
                            </li>
                            <#if isModer>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="moderation-tab" data-bs-toggle="tab"
                                            data-bs-target="#moderation" type="button" role="tab">
                                        <i class="fas fa-tasks me-2"></i>–ú–æ–¥–µ—Ä–∞—Ü–∏—è
                                        <span class="badge bg-danger ms-1" id="moderationCount">0</span>
                                    </button>
                                </li>
                            </#if>
                            <#if isAdmin>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users"
                                            type="button" role="tab">
                                        <i class="fas fa-users me-2"></i>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                                    </button>
                                </li>
                            </#if>
                        </ul>
                    </div>

                    <div class="card-body">
                        <div class="tab-content" id="profileTabsContent">
                            <!-- –í–∫–ª–∞–¥–∫–∞ "–ú–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç" -->
                            <div class="tab-pane fade show active" id="content" role="tabpanel">
                                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                                <div class="content-filters mb-4">
                                    <div class="row g-2">
                                        <div class="col-md-3">
                                            <select class="form-select form-select-sm" id="contentTypeFilter">
                                                <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                                                <option value="posts">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                                                <option value="blog">–ë–ª–æ–≥</option>
                                                <option value="events">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</option>
                                                <option value="books">–ö–Ω–∏–≥–∏</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select form-select-sm" id="contentStatusFilter">
                                                <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-group input-group-sm">
                                                <input type="text" class="form-control" id="contentSearch"
                                                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É...">
                                                <button class="btn btn-outline-secondary" type="button"
                                                        id="contentSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                                <div id="userContentList" class="content-list">
                                    <div class="text-center text-muted py-5">
                                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...</p>
                                    </div>
                                </div>

                                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                                <nav id="contentPagination" class="mt-3" style="display: none;">
                                    <ul class="pagination justify-content-center"></ul>
                                </nav>
                            </div>

                            <!-- –í–∫–ª–∞–¥–∫–∞ "–ú–æ–¥–µ—Ä–∞—Ü–∏—è" (–¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤) -->
                            <#if isModer>
                                <div class="tab-pane fade" id="moderation" role="tabpanel">
                                    <!-- –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                                    <div class="moderation-filters mb-4">
                                        <div class="row g-2">
                                            <div class="col-md-4">
                                                <select class="form-select form-select-sm" id="moderationTypeFilter">
                                                    <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                                                    <option value="posts">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                                                    <option value="blog">–ë–ª–æ–≥</option>
                                                    <option value="events">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</option>
                                                    <option value="books">–ö–Ω–∏–≥–∏</option>
                                                </select>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="input-group input-group-sm">
                                                    <input type="text" class="form-control" id="moderationSearch"
                                                           placeholder="–ü–æ–∏—Å–∫...">
                                                    <button class="btn btn-outline-secondary" type="button"
                                                            id="moderationSearchBtn">
                                                        <i class="fas fa-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                                    <div id="moderationContentList" class="content-list">
                                        <div class="text-center text-muted py-5">
                                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏...</p>
                                        </div>
                                    </div>

                                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                                    <nav id="moderationPagination" class="mt-3" style="display: none;">
                                        <ul class="pagination justify-content-center"></ul>
                                    </nav>
                                </div>
                            </#if>

                            <!-- –í–∫–ª–∞–¥–∫–∞ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤) -->
                            <#if isAdmin>
                                <div class="tab-pane fade" id="users" role="tabpanel">
                                    <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h5 class="mb-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h5>
                                        <a href="/admin/users/create" class="btn btn-primary btn-sm">
                                            <i class="fas fa-user-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                        </a>
                                    </div>

                                    <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                                    <div class="users-filters mb-4">
                                        <div class="row g-2">
                                            <div class="col-md-8">
                                                <div class="input-group input-group-sm">
                                                    <input type="text" class="form-control" id="usersSearch"
                                                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email...">
                                                    <button class="btn btn-outline-secondary" type="button"
                                                            id="usersSearchBtn">
                                                        <i class="fas fa-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <select class="form-select form-select-sm" id="usersSortBy">
                                                    <option value="name">–ü–æ –∏–º–µ–Ω–∏</option>
                                                    <option value="email">–ü–æ email</option>
                                                    <option value="createdAt">–ü–æ –¥–∞—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                                    <div id="usersContentList" class="users-list">
                                        <div class="text-center text-muted py-5">
                                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                                        </div>
                                    </div>

                                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                                    <nav id="usersPagination" class="mt-3" style="display: none;">
                                        <ul class="pagination justify-content-center"></ul>
                                    </nav>
                                </div>
                            </#if>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</@main.layout>